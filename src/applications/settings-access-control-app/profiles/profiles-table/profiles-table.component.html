<k-area-blocker [showLoader]="(_store.profiles.state$ | async)?.loading || this._deferredLoading"
                [message]="_blockerMessage">
  <div class="kAccessControlProfilesTable" [class.noResults]="!_profiles?.length">
    <p-dataTable #dataTable
                 kStickyHeader
                 dataKey="id"
                 scrollable="true"
                 expandableRows="true"
                 scrollHeight="100%"
                 sticksTo="profilesFilters"
                 stickyClass="stickyHeader"
                 stickyId="accessControlProfileTable"
                 [value]="_profiles"
                 [emptyMessage]="_emptyMessage"
                 [rowTrackBy]="rowTrackBy"
                 [sortField]="filter.sortBy"
                 [rowStyleClass]="_profilesTableRowStyle"
                 (selectionChange)="_onSelectionChange($event)"
                 (onSort)="_onSortChanged($event)"
                 [(selection)]="selectedProfiles">
      <p-column selectionMode="multiple" [style]="{'width':'44px', 'padding-left': '14px'}"></p-column>

      <p-column expander="true" [style]="{'width':'44px'}"></p-column>

      <p-column field="name"
                [header]="'applications.settings.accessControl.table.name' | translate">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span class="kAccessControlProfileTableName"
                [kTooltip]="profile?.description"
                [maxWidth]="228"
                (click)="_onActionSelected('edit', profile)">
            {{ profile[col.field] }}
          </span>
        </ng-template>
      </p-column>

      <p-column field="id"
                [header]="'applications.settings.accessControl.table.id' | translate"></p-column>

      <p-column field="createdAt"
                [header]="'applications.settings.accessControl.table.createdOn' | translate"
                [sortable]="'custom'">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span>{{ profile[col.field] | kDate:'MM/DD/YYYY' }}</span>
        </ng-template>
      </p-column>

      <p-column field="domain"
                [header]="'applications.settings.accessControl.table.domain' | translate">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span class="kAccessControlRestriction">
            <i class="kAccessControlRestrictionIcon" [ngClass]="{
            'kIconconfirmation authorized': profile[col.field]?.isAuthorized || !profile[col.field],
            'kIconerror blocked': profile[col.field]?.isAuthorized === false
            }"></i>
            <span>{{ profile[col.field]?.label || ('applications.settings.accessControl.table.allowAll' | translate) }}</span>
          </span>
        </ng-template>
      </p-column>

      <p-column field="countries"
                [header]="'applications.settings.accessControl.table.countries' | translate">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span class="kAccessControlRestriction">
            <i class="kAccessControlRestrictionIcon" [ngClass]="{
            'kIconconfirmation authorized': profile[col.field]?.isAuthorized || !profile[col.field],
            'kIconerror blocked': profile[col.field]?.isAuthorized === false
            }"></i>
            <span>{{ profile[col.field]?.label || ('applications.settings.accessControl.table.allowAll' | translate) }}</span>
          </span>
        </ng-template>
      </p-column>

      <p-column field="ips"
                [header]="'applications.settings.accessControl.table.ips' | translate">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span class="kAccessControlRestriction">
            <i class="kAccessControlRestrictionIcon" [ngClass]="{
            'kIconconfirmation authorized': profile[col.field]?.isAuthorized || !profile[col.field],
            'kIconerror blocked': profile[col.field]?.isAuthorized === false
            }"></i>
            <span>{{ profile[col.field]?.label || ('applications.settings.accessControl.table.allowAll' | translate) }}</span>
          </span>
        </ng-template>
      </p-column>

      <p-column field="flavors"
                [header]="'applications.settings.accessControl.table.flavors' | translate">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span class="kAccessControlRestriction">
            <i class="kAccessControlRestrictionIcon" [ngClass]="{
            'kIconconfirmation authorized': profile[col.field]?.isAuthorized || !profile[col.field],
            'kIconerror blocked': profile[col.field]?.isAuthorized === false
            }"></i>
            <span>{{ profile[col.field]?.label || ('applications.settings.accessControl.table.allowAll' | translate) }}</span>
          </span>
        </ng-template>
      </p-column>

      <p-column field="advancedSecurity"
                [header]="'applications.settings.accessControl.table.advancedSecurity' | translate">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <span>{{ profile[col.field]?.label }}</span>
        </ng-template>
      </p-column>

      <p-column header="" [style]="{'overflow':'visible', 'width':'80px'}">
        <ng-template let-col let-profile="rowData" pTemplate="body">
          <div class="kAccessControlProfilesTableActions">
            <button type="button" pButton icon="kIconmore" (click)="_openActionsMenu($event, profile)"></button>
          </div>
        </ng-template>
      </p-column>
      <ng-template let-profile pTemplate="rowexpansion">
        <div class="kAccessControlProfilesDetailRow">
          <table *ngIf="profile?.details?.length">
            <tr *ngFor="let detail of profile.details">
              <td class="kStub1"></td>
              <td class="kStub1"></td>
              <td colspan="3"></td>
              <td>{{detail.domain}}</td>
              <td class="kCountryList">
                <div *ngIf="detail.country">
                  <img class="kCountryListFlag" [src]="detail.country | kCountryFromCode:'icon'" [alt]="detail.country">
                  {{detail.country | kCountryFromCode:'label'}}
                </div>
              </td>
              <td>{{detail.ip}}</td>
              <td>{{detail.flavor}}</td>
              <td>{{detail.advancedSecurity}}</td>
              <td class="kStub2"></td>
            </tr>
          </table>
        </div>
      </ng-template>
    </p-dataTable>
    <p-menu #actionsmenu popup="popup" [model]="_items" [appendTo]="'body'" kMenuCloseOnScroll></p-menu>
  </div>
</k-area-blocker>
